<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	</h:head>

	<h:form id="addUserForm" style="border:0px">
		<p:commandButton id="userAdd" value="Agregar" style="margin:10px"
			onclick="addUserWidget.show();" type="button" />

		<p:dialog id="addUSerDialog" widgetVar="addUserWidget"
			resizable="false" header="Agregar Usuario" closable="false"
			modal="true">
			<ui:include src="agregar/addUsuario.xhtml" />
		</p:dialog>
	</h:form>

	<h:form id="userDataTableForm">
		<p:dataTable id="userDataTable" var="user"
			value="#{userController.dataModel}" rowIndexVar="userIndex"
			widgetVar="usersTable" emptyMessage="No hay coincidencias"
			selection="#{userController.selectedItems}" paginator="true"
			paginatorPosition="bottom" rows="10"
			paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
			style="width:800px;text-align:center">

			<f:facet name="header">
				<p:outputPanel>
					<h:outputText value="Buscar:" />
					<p:inputText id="globalFilter" onkeyup="usersTable.filter()"
						style="width:200px" />
					<p:watermark for="globalFilter" value="Usuario" />
				</p:outputPanel>
			</f:facet>

			<p:column selectionMode="multiple" style="width:auto" />

			<p:column id="userRowNumber" headerText="NÂº" style="width:auto">
				<p:commandLink style="text-decoration:none" value="#{userIndex + 1}"
					ajax="true"
					actionListener="#{userController.storeOriginalItem(user)}"
					oncomplete="modifyUserWidget.show();">
					<f:setPropertyActionListener
						target="#{userController.selectedItem}" value="#{user}" />
					<f:setPropertyActionListener
						target="#{userController.selectedProfiles}"
						value="#{userController.userProfilesAsArray}" />
				</p:commandLink>
			</p:column>

			<p:column id="userLegajo" filterBy="#{user.legajo}"
				filterStyle="display:none" headerText="Legajo"
				filterMatchMode="contains" style="width:auto">
				<p:commandLink style="text-decoration:none" value="#{user.legajo}"
					actionListener="#{userController.storeOriginalItem(user)}"
					oncomplete="modifyUserWidget.show();">
					<f:setPropertyActionListener
						target="#{userController.selectedItem}" value="#{user}" />
					<f:setPropertyActionListener
						target="#{userController.selectedProfiles}"
						value="#{userController.userProfilesAsArray}" />
				</p:commandLink>
			</p:column>

			<p:column id="userName" filterBy="#{user.nombre}"
				filterStyle="display:none" headerText="Nombre"
				filterMatchMode="contains" style="width:auto">
				<p:commandLink style="text-decoration:none" value="#{user.nombre}"
					actionListener="#{userController.storeOriginalItem(user)}"
					oncomplete="modifyUserWidget.show();">
					<f:setPropertyActionListener
						target="#{userController.selectedItem}" value="#{user}" />
					<f:setPropertyActionListener
						target="#{userController.selectedProfiles}"
						value="#{userController.userProfilesAsArray}" />
				</p:commandLink>
			</p:column>

			<p:column id="userApellido" filterBy="#{user.apellido}"
				filterStyle="display:none" headerText="Apellido"
				filterMatchMode="contains" style="width:auto">
				<p:commandLink style="text-decoration:none" value="#{user.apellido}"
					actionListener="#{userController.storeOriginalItem(user)}"
					oncomplete="modifyUserWidget.show();">
					<f:setPropertyActionListener
						target="#{userController.selectedItem}" value="#{user}" />
					<f:setPropertyActionListener
						target="#{userController.selectedProfiles}"
						value="#{userController.userProfilesAsArray}" />
				</p:commandLink>
			</p:column>

			<p:column id="userProfiles" filterStyle="display:none"
				headerText="Perfiles" style="width:auto">
				<ui:repeat var="perfil" value="#{user.perfiles}">
					<p:commandLink style="text-decoration:none" value="#{perfil.name}"
						actionListener="#{userController.storeOriginalItem(user)}"
						oncomplete="modifyUserWidget.show();">
						<f:setPropertyActionListener
							target="#{userController.selectedItem}" value="#{user}" />
						<f:setPropertyActionListener
							target="#{userController.selectedProfiles}"
							value="#{userController.userProfilesAsArray}" />
					</p:commandLink>
					<br />
				</ui:repeat>
			</p:column>

		</p:dataTable>
		<p:dialog id="modifyUserDialog" header="Modificar Usuario"
			dynamic="true" widgetVar="modifyUserWidget" modal="true"
			resizable="false" closable="false">
			<ui:include src="modificar/modifyUsuario.xhtml" />

		</p:dialog>

	</h:form>
</ui:composition>
